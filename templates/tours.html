{% extends "layout.html" %}

{% block content %}
<div class="page-header"
    style="background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('{{ url_for('static', filename='images/header_tours.png') }}') no-repeat center center/cover;">
    <div>
        <h1>Our Packages</h1>
        <div class="breadcrumb">
            <a href="{{ url_for('home') }}">Home</a> <span>/</span> Packages
        </div>
    </div>
</div>

<section class="tours-section">
    <div class="tours-layout">
        <!-- Sidebar Filters -->
        <aside class="tour-sidebar">
            <div class="filter-box">
                <h4 class="filter-title">Categories</h4>
                <div class="filter-group">
                    <!-- 1. All Packages Button (Always Visible) -->
                    <button class="filter-btn active" data-filter="all">All Packages</button>

                    <!-- 2. Master Button (Toggle) -->
                    <button class="filter-btn master-toggle" id="categoryToggle"
                        style="background: var(--primary); color: white; justify-content: space-between; display: flex; align-items: center;">
                        Select Category <i class="fas fa-chevron-down"></i>
                    </button>

                    <!-- Hidden Category List -->
                    <div class="category-dropdown" id="categoryList"
                        style="display: none; padding-left: 10px; margin-top: 10px; border-left: 2px solid #eee;">
                        {% for category in categories %}
                        <button class="filter-btn" data-filter="{{ category.category_id }}">{{ category.name }}</button>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </aside>

        <!-- Tours Grid -->
        <div class="card-container" style="grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));">
            {% for category in categories %}
            <div class="card" data-category="{{ category.category_id }}">
                <div class="card-image">
                    <img src="{{ url_for('static', filename='images/' + category.image) }}" alt="{{ category.name }}">
                </div>
                <div class="card-body">
                    <h3 class="category-title">{{ category.name }}</h3>
                    <p style="margin-bottom: 1rem;"><i class="far fa-clock"></i> 5 Days / 4 Nights</p>
                    <p>Explore our exclusive {{ category.name.lower() }} packages designed just for you.</p>
                </div>
                <div class="card-footer">
                    <span class="card-price">â‚¹15,000<span>/person</span></span>
                    <a href="{{ url_for('enquiry', tour_type=category.category_id) }}" class="btn btn-glass-small">View
                        Details</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Toggle Logic
        const toggleBtn = document.getElementById('categoryToggle');
        const list = document.getElementById('categoryList');
        const icon = toggleBtn.querySelector('i');

        toggleBtn.addEventListener('click', () => {
            if (list.style.display === 'none' || list.style.display === '') {
                list.style.display = 'grid'; // Fixed: Use Grid layout
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                list.style.display = 'none';
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        });

        const filterBtns = document.querySelectorAll('.filter-btn');
        const cards = document.querySelectorAll('.card');

        filterBtns.forEach(btn => {
            if (btn.classList.contains('master-toggle')) return; // Skip master button

            btn.addEventListener('click', () => {
                // Remove active class from all buttons (except master)
                filterBtns.forEach(b => {
                    if (!b.classList.contains('master-toggle')) b.classList.remove('active')
                });
                // Add active class to clicked button
                btn.classList.add('active');

                const filterValue = btn.getAttribute('data-filter');

                cards.forEach(card => {
                    if (filterValue === 'all' || card.getAttribute('data-category') === filterValue) {
                        card.style.display = 'block'; // Fixed: Use block instead of flex to prevent layout squeeze
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });
    });
</script>
{% endblock %}